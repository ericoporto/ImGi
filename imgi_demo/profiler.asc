// Profiler module script

File* pf;
AudioChannel* time;
int ts;
void InitProfiler()
{
  time = aRain_calm.Play(eAudioPriorityHigh, eRepeat);
  pf = File.Open("$SAVEGAMEDIR$/profile.json",eFileWrite);
  pf.WriteRawLine("[\n");
  pf.Close();
  pf = File.Open("$SAVEGAMEDIR$/profile.json",eFileAppend);
}

void CloseProfiler()
{
  pf.WriteRawLine("\n]");
  pf.Close();
}

void pro(const string cat, const string name, const string ph)
{
  ts = DateTime.Now.RawTime;
  
  if(pf)
    pf.WriteRawLine(
      String.Format("{\"cat\": \"%s\", \"pid\": 1, \"tid\": 1, \"ts\": %d, \"ph\": \"%s\", \"name\": \"%s\", \"args\": {} },\n", 
        cat, ts, ph, name));
}